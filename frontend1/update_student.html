<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <!-- bootstrap css -->
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
      integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
      crossorigin="anonymous"
    />
    <!-- bootstrap js -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
      integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
      integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
      crossorigin="anonymous"
    ></script>
  </head>

  <body>
    <div
      class="d-flex flex-column"
      id="index_container"
      style="width: 98vw; overflow: hidden"
    >
      <div id="header">
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
          <a class="navbar-brand" href="#">Student Portal</a>
          <button
            class="navbar-toggler"
            type="button"
            data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <span class="navbar-toggler-icon"></span>
          </button>

          <div
            class="collapse navbar-collapse"
            id="navbarSupportedContent"
          ></div>
        </nav>
      </div>
      <div
        id="new_student"
        class="container border border-info"
        style="margin: 70px auto"
      >
        <div
          class="operation_buttons my-1"
          style="display: flex; justify-content: space-between"
        >
          <a
            href="dashboard.html"
            class="btn btn-sm btn-info"
            style="float: left"
            >Back</a
          >
          <span style="float: right">
            <a class="btn btn-sm btn-success mx-2" id="update_student"
              >Update</a
            >
            <a class="btn btn-sm btn-danger mx-2" id="delete_student">Delete</a>
          </span>
        </div>
        <form>
          <div class="form-row" style="margin: 1rem 0">
            <div class="col">
              <div class="form-group">
                <label for="first_name">First Name</label>
                <input
                  type="text"
                  class="form-control"
                  id="first_name"
                  aria-describedby="emailHelp"
                  placeholder="Enter First Name"
                  required
                  readonly
                />
              </div>
            </div>
            <div class="col">
              <div class="form-group">
                <label for="last_name">Last Name</label>
                <input
                  type="text"
                  class="form-control"
                  id="last_name"
                  aria-describedby="emailHelp"
                  placeholder="Last Name"
                  required
                  readonly
                />
              </div>
            </div>
          </div>
          <div class="form-row" style="margin: 1rem 0">
            <div class="col">
              <div class="form-group">
                <label for="university_email">University Email address</label>
                <input
                  type="email"
                  class="form-control"
                  id="university_email"
                  aria-describedby="emailHelp"
                  placeholder="Enter University Email"
                  required
                  readonly
                />
              </div>
            </div>
            <div class="col">
              <div class="form-group">
                <label for="dob">DOB</label>
                <input
                  type="text"
                  class="form-control"
                  id="dob"
                  aria-describedby="emailHelp"
                  placeholder="Enter DOB"
                  readonly
                />
              </div>
            </div>
          </div>
          <div class="form-row" style="margin: 1rem 0">
            <div class="col">
              <div class="form-group">
                <label for="phone_number">Phone Number</label>
                <input
                  type="text"
                  class="form-control"
                  id="phone_number"
                  aria-describedby="emailHelp"
                  placeholder="Enter Phone Number"
                  readonly
                />
              </div>
            </div>
            <div class="col">
              <div class="form-group">
                <label for="personal_email">Personal Email address</label>
                <input
                  type="email"
                  class="form-control"
                  id="personal_email"
                  aria-describedby="emailHelp"
                  placeholder="Enter Personal Email"
                  readonly
                />
              </div>
            </div>
          </div>
          <div class="form-row" style="margin: 1rem 0">
            <div class="col">
              <div class="form-group">
                <label for="degree_enrolled">Degree Enrolled</label>
                <input
                  type="text"
                  class="form-control"
                  id="degree_enrolled"
                  aria-describedby="emailHelp"
                  placeholder="Enter Degree Enrolled"
                  name="degree_enrolled"
                  readonly
                />
              </div>
            </div>
            <div class="col">
              <div class="form-group">
                <label for="college_institute">College/Institute</label>
                <input
                  type="text"
                  class="form-control"
                  id="college_institute"
                  aria-describedby="emailHelp"
                  placeholder="Enter College/Institute"
                  name="college_institute"
                  readonly
                />
              </div>
            </div>
          </div>
          <div class="form-row" style="margin: 1rem 0">
            <div class="col">
              <div class="form-group">
                <label for="department">Department</label>
                <input
                  type="text"
                  class="form-control"
                  id="department"
                  aria-describedby="emailHelp"
                  placeholder="Enter Department"
                  name="department"
                  readonly
                />
              </div>
            </div>
            <div class="col">
              <div class="form-group">
                <label for="specialization">Spacialization</label>
                <input
                  type="text"
                  class="form-control"
                  id="specialization"
                  aria-describedby="emailHelp"
                  placeholder="Enter Spacialization"
                  name="specialization"
                  readonly
                />
              </div>
            </div>
          </div>
          <div class="form-row" style="margin: 1rem 0">
            <div class="col">
              <div class="form-group">
                <label for="overall_grade">Overall Grade</label>
                <input
                  type="text"
                  class="form-control"
                  id="overall_grade"
                  aria-describedby="emailHelp"
                  placeholder="Enter Overall Grade"
                  name="overall_grade"
                  readonly
                />
              </div>
            </div>
            <div class="col">
              <div class="form-group">
                <label for="enrollment_status">Enrollment Status</label>
                <select
                  class="form-control"
                  id="enrollment_status"
                  name="enrollment_status"
                  required
                  readonly
                >
                  <option>Select</option>
                  <option value="active">Active</option>
                  <option value="alumni">Alumni</option>
                  <option value="deferred">Deferred</option>
                </select>
              </div>
            </div>
          </div>
          <div class="form-row" style="margin: 1rem 0">
            <div class="col-12">
              <div class="form-group">
                <label for="address">Address</label>
                <textarea
                  class="form-control"
                  id="address"
                  rows="3"
                  readonly
                ></textarea>
              </div>
            </div>
          </div>
          <button
            type="button"
            class="btn btn-info"
            id="new_student_save_button"
            style="margin: 1rem"
            disabled
          >
            SAVE
          </button>
        </form>
      </div>
    </div>
    <script>
      $(document).ready(() => {
        const queryString = window.location.search;
        const urlParams = new URLSearchParams(queryString);
        const id = urlParams.get("id");

        $("#update_student").on("click", () => {
          if (
            $(".form-control").is("[readonly]") &&
            $("#new_student_save_button").is("[disabled]")
          ) {
            $(".form-control").removeAttr("readonly");
            $("#new_student_save_button").removeAttr("disabled");
          } else {
            $(".form-control").prop("readonly", "true");
            $("#new_student_save_button").prop("disabled", "true");
          }
        });

        $("#delete_student").on("click", () => {
          if (confirm("Are You Sure ?")) {
            $.ajax({
              contentType: "application/json; charset=utf-8",
              url: "http://localhost:9000/students/" + id,
              type: "DELETE",
              success: (message) => {
                if (message == "Student Data Deleted Successfully") {
                  alert(message);
                  window.location.href = "dashboard.html";
                } else {
                  alert(message);
                }
              },
            });
          }
        });

        $.ajax({
          contentType: "application/json; charset=utf-8",
          url: "http://localhost:9000/students/" + id,
          type: "GET",
          success: (students) => {
            students.forEach((student) => {
              $("#first_name").val(student.first_name);
              $("#last_name").val(student.last_name);
              $("#university_email").val(student.university_email);
              $("#dob").val(student.dob);
              $("#phone_number").val(student.phone_number);
              $("#personal_email").val(student.personal_email);
              $("#degree_enrolled").val(student.degree_enrolled);
              $("#college_institute").val(student.college_institute);
              $("#department").val(student.department);
              $("#specialization").val(student.specialization);
              $("#overall_grade").val(student.overall_grade);
              $("#enrollment_status").val(student.enrollment_status);
              $("#address").val(student.address);
            });
          },
        });

        $("#new_student_save_button").on("click", (e) => {
          e.preventDefault();
          let first_name = $("#first_name").val();
          let last_name = $("#last_name").val();
          let university_email = $("#university_email").val();
          let dob = $("#dob").val();
          let phone_number = $("#phone_number").val();
          let personal_email = $("#personal_email").val();
          let degree_enrolled = $("#degree_enrolled").val();
          let college_institute = $("#college_institute").val();
          let department = $("#department").val();
          let specialization = $("#specialization").val();
          let overall_grade = $("#overall_grade").val();
          let enrollment_status = $("#enrollment_status").val();
          let address = $("#address").val();

          if (
            first_name &&
            last_name &&
            university_email &&
            enrollment_status
          ) {
            $.ajax({
              contentType: "application/json; charset=utf-8",
              url: "http://localhost:9000/students/" + id,
              type: "PUT",
              data: JSON.stringify({
                first_name: first_name,
                last_name: last_name,
                university_email: university_email,
                dob: dob,
                phone_number: phone_number,
                personal_email: personal_email,
                degree_enrolled: degree_enrolled,
                college_institute: college_institute,
                department: department,
                specialization: specialization,
                overall_grade: overall_grade,
                enrollment_status: enrollment_status,
                address: address,
              }),
              success: (message, status) => {
                if (message == "Student Data Updated Successfully") {
                  alert(message);
                  $.ajax({
                    contentType: "application/json; charset=utf-8",
                    url: "http://localhost:9000/students/" + id,
                    type: "GET",
                    success: (students) => {
                      students.forEach((student) => {
                        $("#first_name").val(student.first_name);
                        $("#last_name").val(student.last_name);
                        $("#university_email").val(student.university_email);
                        $("#dob").val(student.dob);
                        $("#phone_number").val(student.phone_number);
                        $("#personal_email").val(student.personal_email);
                        $("#degree_enrolled").val(student.degree_enrolled);
                        $("#college_institute").val(student.college_institute);
                        $("#department").val(student.department);
                        $("#specialization").val(student.specialization);
                        $("#overall_grade").val(student.overall_grade);
                        $("#enrollment_status").val(student.enrollment_status);
                        $("#address").val(student.address);
                      });
                      $(".form-control").prop("readonly", "true");
                      $("#new_student_save_button").prop("disabled", "true");
                    },
                  });
                } else {
                  alert(message);
                }
              },
            });
          }
        });
      });
    </script>
  </body>
</html>
